<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KOOSHIN AI | Record & Snow</title>
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        
        /* Camera Area */
        .container { position: relative; width: 100%; height: 75vh; background: #111; border-bottom: 2px solid #00f2ff; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); filter: brightness(1.1) saturate(1.2); }

        /* Snow Effect */
        .snow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .flake { position: absolute; top: -10px; background: white; border-radius: 50%; opacity: 0.8; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(75vh); } }

        /* Controls */
        .footer { height: 25vh; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #050505; }
        .rec-btn { width: 80px; height: 80px; background: white; border: 5px solid #333; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .rec-btn.active { background: red; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .inner-circle { width: 30px; height: 30px; background: red; border-radius: 50%; }
    </style>
</head>
<body>

    <div class="container">
        <video id="webcam" autoplay playsinline muted></video>
        <div class="snow" id="snowBox"></div>
    </div>

    <div class="footer">
        <p id="status" style="color: #00f2ff; margin-bottom: 10px;">RIIX SI AAD U DUUBTO</p>
        <div class="rec-btn" id="recBtn" onclick="toggleRecording()">
            <div class="inner-circle"></div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let recordedChunks = [];
        const videoElement = document.getElementById('webcam');

        // 1. Bilow Kamaradda
        async function startApp() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user", width: 1280, height: 720 },
                    audio: true 
                });
                videoElement.srcObject = stream;
                createSnow();
            } catch (err) {
                document.getElementById('status').innerText = "Cillad: Fadlan ogolow Kamaradda!";
                console.error(err);
            }
        }

        // 2. Barafka Samee
        function createSnow() {
            const snowBox = document.getElementById('snowBox');
            for (let i = 0; i < 40; i++) {
                let flake = document.createElement('div');
                flake.className = 'flake';
                let size = Math.random() * 4 + 2 + 'px';
                flake.style.width = size; flake.style.height = size;
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = Math.random() * 3 + 2 + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                snowBox.appendChild(flake);
            }
        }

        // 3. Duubista iyo Dagsashada
        function toggleRecording() {
            const btn = document.getElementById('recBtn');
            const status = document.getElementById('status');

            if (!mediaRecorder || mediaRecorder.state === "inactive") {
                // Bilow Duubista
                recordedChunks = [];
                const stream = videoElement.srcObject;
                mediaRecorder = new MediaRecorder(stream);
                
                mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) recordedChunks.push(e.data); };
                
                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Kooshin_AI_Video.webm'; // Magaca loo dagsanayo
                    a.click();
                    status.innerText = "MUQAALKA WAA LA DAGSADAY!";
                };

                mediaRecorder.start();
                btn.classList.add('active');
                status.innerText = "WAA LA DUUBAYAA...";
            } else {
                // Jooji Duubista
                mediaRecorder.stop();
                btn.classList.remove('active');
                status.innerText = "DIYAARINAYAA...";
            }
        }

        startApp();
    </script>
</body>
</html>
